var bodyParser= require("body-parser");
var urlencodedParser = bodyParser.urlencoded({extended:false});


module.exports = function(app,passport){

	//==================================================================
	//LOGIN Request
	//==================================================================
	app.get('/login',function(req,res){
		res.sendFile('foundation-5.4.6/frangipani-login.html',{root:'.'})
	})

	app.post('/login',urlencodedParser,passport.authenticate('local-login',{
		successRedirect:'/success',
		failureRedirect:'/failure',
		failureFlash:true
	}));
		
	//==================================================================
	//SIGNUP Request
	//==================================================================
	app.get('/signup',function(req,res){
		res.sendFile('foundation-5.4.6/frangipani-signup.html',{root:'.'})
	});

	//parse signup information
	app.post('/signup',urlencodedParser,passport.authenticate('local-signup',{
		successRedirect:'/success',
		failureRedirect:'/failure',
		failureFlash:true
	}));

	app.get('/recover', function(req,res){
		if (req.isAuthenticated())
			res.redirect('/');
		
		res.sendFile('foundation-5.4.6/frangipani-recover.html',{root:'.'});
	});

	//route to send information in the event of a login failure
	app.get('/failure',function(req,res){
		var response ={status:'failed',error:req.flash('error'),redirectURL:undefined,statCode:req.flash('statusCode')}
		res.send(JSON.stringify(response))
	});

	//route to send information in the event of a login success
	app.get('/success',function(req,res){
		var response = {status:'ok',error:undefined,redirectURL:'/',statusCode:req.flash('statusCode')}
		res.send(JSON.stringify(response))
	})
	//==================================================================
	//LOGIN WITH GOOGLE Request
	//==================================================================
	app.get('/auth/google', passport.authenticate('google', { scope : ['profile', 'email'] }));


	//==================================================================
	//RESPONSE FROM GOOGLE Request
	//==================================================================
    app.get('/auth/google/callback',
        passport.authenticate('google', {
            successRedirect : '/',
            failureRedirect : '/login'
       	})
    );

	//==================================================================
	//Logout
	//==================================================================
	app.get('/logout', function(req,res){
		req.logout()
		res.redirect('/')
	})

}